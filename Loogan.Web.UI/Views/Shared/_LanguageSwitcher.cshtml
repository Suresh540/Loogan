@using Microsoft.AspNetCore.Builder
@using Microsoft.AspNetCore.Localization
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Options
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@inject IOptions<RequestLocalizationOptions> LocOptions
@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    var cultureItems = LocOptions?.Value?.SupportedUICultures?
        .Select(c => new SelectListItem { Value = c.Name, Text = c.DisplayName })
        .ToList();
}
@using (Html.BeginForm("SetLanguage", "Language", FormMethod.Post))
{
    <input type="hidden" id="culture" />
    <input type="hidden" id="returnurl" name="returnurl" />
    <div class="row">
        <div class="col-1">
            <label class="form-label">Language:</label>
        </div>
        <div class="col-4">
            <select class="form-select" name="culture" onchange="onChange(this)"
                    asp-for="@requestCulture.RequestCulture.UICulture.Name"
                    asp-items="cultureItems">
            </select>
        </div>
        <div class="col-3">
            <input class="btn btn-primary" type="submit" value="Change Language" />
        </div>
    </div>
}
<script>
    function onChange(ctrl) {
        document.getElementById('culture').value = '';
        document.getElementById('culture').value = ctrl.value;
        document.getElementById('returnurl').value = window.location.pathname;
    }
</script>
